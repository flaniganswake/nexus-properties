var NPVNexus=NPVNexus||{};NPVNexus.Delay=1e3;NPVNexus.Nav=function(){return Init=function(){$(document).ready(function(){$(".navbar-nav .dropdown").hover(function(){$(this).addClass("open")},function(){$(this).removeClass("open")})})},{init:Init}}();NPVNexus.Status=function(){var n=null,t=1500,i=function(i){var r=$("#StatusAlert"),u=i!=null?i:"* An error Occured";r.html(u).removeClass("loading").addClass("error");n=window.setTimeout(function(){r.removeClass("error")},t);console.log(u)},r=function(i){var r=$("#StatusAlert"),u=i!=null?i:"* Saved";r.html(u).removeClass("loading").addClass("success");n=window.setTimeout(function(){r.removeClass("success")},t)},u=function(t,i){var r=$("#StatusAlert"),u=t!=null?t:"* Processing...";return r.html(u).addClass("loading"),i&&(n=window.setTimeout(function(){r.removeClass("loading")},i)),!0},f=function(){var n=$("#StatusAlert");n.removeClass("loading")};return{error:i,loading:u,success:r,removeLoading:f}}();NPVNexus.Formatters=function(){var n=function(n){return ret="",n&&(ret="$"+n.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")),ret},i=function(n){return n.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")},t=function(n){return FriendlyDictionary[n]!=null?FriendlyDictionary[n]:n};return{currency:n,friendlyName:t}}();NPVNexus.View_Appraisal=function(){var f,n=[],e=function(){$(document).ready(function(){l();s();f=$("table").footable({})})},o=function(n,t){if(t.length>0){var i=new google.maps.LatLng(t[0][0],t[0][1]),r={center:i,zoom:13},u=new google.maps.Map(n,r);_.each(t,function(n,i){var r=new google.maps.Marker({position:new google.maps.LatLng(t[i][0],t[i][1]),map:u})})}},s=function(){$("#BtnActive,#BtnHistorical,#BtnSimilar").click(function(){h($(this).attr("id"))});$("#Update").on("click",function(n){n.preventDefault();n.stopPropagation();c($(this))});$("#InvoiceSent").on("change",function(){r($(this))});$("#Status").on("change",function(){$(this).val()!="COMPLETED"&&$(this).val()!="DRAFT_SENT"?($(".showhideoptions").hide(),i($(this),function(){r($("#InvoiceSent"))}),$("#InvoiceSent").removeAttr("checked").attr("disabled","true")):($("#InvoiceSent").removeAttr("disabled"),$(".showhideoptions").show(),$(this).val()=="COMPLETED"?($("#InvoiceSent").attr("disabled","true"),t(!0),i($(this))):t(!1))});$("#Expenses").on("keyup",function(){n[0]&&window.clearTimeout(n[0]);var t=$("#Expenses"),i=/^\s*(\+|-)?((\d+(\.\d\d)?)|(\.\d\d))\s*$/;n[0]=window.setTimeout(function(){var n=t.val();n.match(i)?(n.indexOf(".")==-1&&t.val(n+".00"),t.removeClass("error"),u(t)):t.addClass("error")},NPVNexus.Delay)});$("#ExpensesHeld").on("keyup",function(){n[1]&&window.clearTimeout(n[1]);var t=$("#ExpensesHeld"),i=/^\s*(\+|-)?((\d+(\.\d\d)?)|(\.\d\d))\s*$/;n[1]=window.setTimeout(function(){var n=t.val();n.match(i)?(n.indexOf(".")==-1&&t.val(n+".00"),t.removeClass("error"),u(t)):t.addClass("error")},NPVNexus.Delay)})},h=function(n){$(".tablebtn.active").removeClass("active");$("#"+n).addClass("active");switch(n){case"BtnActive":$("#Active").show().trigger("footable_resize");$("#Historical,#Similar").hide();break;case"BtnHistorical":$("#Historical").show().trigger("footable_resize");$("#Active,#Similar").hide();break;case"BtnSimilar":$("#Similar").show().trigger("footable_resize");$("#Active,#Historical").hide()}$("table.footable").trigger("footable_redraw")},i=function(n,t){NPVNexus.Status.loading();$.ajax({type:"PATCH",dataType:"JSON",url:$("#Update").attr("href"),data:JSON.stringify({status:$("#Status").val()}),contentType:"application/json",success:function(){t&&t();NPVNexus.Status.success()},error:function(){NPVNexus.Status.error()}})},r=function(n){NPVNexus.Status.loading();$.ajax({type:"PATCH",dataType:"JSON",url:$("#Update").attr("href"),data:JSON.stringify({invoice_sent:n.prop("checked")}),contentType:"application/json",success:function(){NPVNexus.Status.success()},error:function(){NPVNexus.Status.error()}})},u=function(){NPVNexus.Status.loading();$.ajax({type:"PATCH",dataType:"JSON",url:$("#Update").attr("href"),data:JSON.stringify({expenses:$("#Expenses").val().toString(),expenses_held:$("#ExpensesHeld").val().toString()}),contentType:"application/json",success:function(){NPVNexus.Status.success()},error:function(){NPVNexus.Status.error()}})},c=function(n){NPVNexus.Status.loading();$.ajax({type:"PATCH",dataType:"JSON",url:n.attr("href"),data:JSON.stringify({hours_spent:$("#HoursSpent").val(),final_value:$("#FinalValue").val(),status:$("#Status").val()}),contentType:"application/json",success:function(){NPVNexus.Status.success()},error:function(){NPVNexus.Status.error()}})},l=function(){var n=$("#Status").val();n!="COMPLETED"&&n!="DRAFT_SENT"?$(".showhideoptions").hide():($(".showhideoptions").show(),n=="COMPLETED"&&($("#InvoiceSent").attr("disabled","true"),t(!0)))},t=function(n){n?($("#HoursSpent").attr("disabled",!0),$("#FinalValue").attr("disabled",!0),$("#Update").hide()):($("#HoursSpent").removeAttr("disabled"),$("#FinalValue").removeAttr("disabled"),$("#Update").show())};return{init:e,setUpMap:o}}();NPVNexus.View_Client_List=function(){var n=function(){$(document).ready(function(){$("table").footable({});$(".tooltipicon").tooltip({})})};return{init:n}}();NPVNexus.View_State_Licensing=function(){var e="#ccc",i="#003e7e",r="#6b9dd3",o="#d2252c",s="730",h="480",c="330",l="200",n=0,t=0,u=null;document.captureEvents&&Event.MOUSEMOVE&&document.captureEvents(Event.MOUSEMOVE);var a=function(i){var r=$(window).scrollTop();i&&i.pageX?(n=i.pageX,t=i.pageY-r):(n=event.clientX+document.body.scrollLeft,t=event.clientY+document.body.scrollTop);n<0&&(n=0);t<0&&(t=0);$("#Map").next(".point").css({left:n-50,top:t-70})},f=function(n){var t=0,i=0;$(window).width()<=750?(t=l,i=c):(t=h,i=s);n.changeSize(i,t,!0,!1);$(".mapWrapper").css({width:i+"px",height:t+"px"})},v=function(){$(document).ready(function(){document.body.onmousemove=a;$("table").footable({});y()})},y=function(){var s=new ScaleRaphael("Map",930,580),l={fill:i,cursor:"pointer",stroke:r,"stroke-width":1,"stroke-linejoin":"round"},h=[],t,n,c;names=[];$stateSelect=$("#StateNames");for(t in usamappaths)n=s.path(usamappaths[t].path),n.attr(l),h[n.id]=usamappaths[t].abv,names[n.id]=usamappaths[t].name,c=$("<option/>",{value:h[n.id]}).text(usamappaths[t].name),$stateSelect.append(c),n.attr({fill:i}),n.mouseover(function(){this!=u&&(this.animate({fill:e,stroke:o,"stroke-width":2},500),this.toFront())}),n.mouseout(function(){this!=u&&this.animate({fill:i,fill:i,stroke:r},500);$("#map").next(".point").remove()}),n.mouseup(function(){var n=h[this.id];window.location="/license-info/"+n});$("body").on("change","#StateNames",function(){window.location="/license-info/"+$(this).val()});$(window).resize(function(){f(s)});f(s)};return{init:v}}();NPVNexus.View_State_Licensing_Info=function(){return Init=function(){$(document).ready(function(){$(".footable").footable({})})},{init:Init}}();NPVNexus.View_AMF=function(){var n=function(){$("#BtnActive").click(function(){$("#Active").show();$("#Historical").hide();$(".active").removeClass("active");$("#BtnActive").addClass("active")});$("#BtnHistorical").click(function(){$("#Active").hide();$("#Historical").show();$(".active").removeClass("active");$("#BtnHistorical").addClass("active")})},t=function(){$(document).ready(function(){$("table").footable({});n()})};return{init:t}}();NPVNexus.View_Appraiser_Home=function(){var t,i,r=new Date,n=r.getMonth()+1,a=r.getFullYear(),e=function(n){t=n;$(document).ready(function(){i=$("table.footable").footable({});o();h()})},o=function(){$("#DateBtn").click(function(){NPVNexus.Status.loading();var i=f($("#StDate").val()),r=f($("#EndDate").val()),n="/api/v1/assignment/?employee="+t+"&role__in=APPRAISER,ASSOCIATE,RESEARCHER&appraisal__due_date__gte="+i+"&appraisal__due_date__lte="+r;n+="&fields=appraisal__job_number,appraisal__due_date,appraisal__engagement_property__property__name,appraisal__engagement_property__property__id,appraisal__id";n+=",appraisal__engagement_property__engagement__client__name,appraisal__engagement_property__engagement__client__id,appraisal__engagement_property__property__property_type,appraisal__engagement_property__property__property_subtype,fee,role,appraisal__status,appraisal__hours_spent";u($("#Assignments tbody"),n)});$("#Filter").change(function(){$(this).val()=="Date Range"?($(".quarters").toggle(),$(".dates").toggle()):$(this).val()=="Quarters"&&($(".quarters").toggle(),$(".dates").toggle())});$("#QuarterBtn").click(function(){NPVNexus.Status.loading();var n=l($("#QuartersQt").val(),$("#QuartersYrs").val());u($("#Assignments tbody"),n)})},s=function(){var t=0;return n>0&&n<4?t=1:n>3&&n<7?t=2:n>6&&n<10?t=3:n>9&&n<13&&(t=4),t},h=function(){$(".dates").hide();NPVNexus.GetYearRange(2010,$("#QuartersYrs"));$("#QuartersQt > option[value="+s()+"]").each(function(){$(this).prop("selected","true")});$("#Filter option:first-child").attr("selected","selected");$("#QuarterBtn").trigger("click")},u=function(n,t){var i={rs:null};$.ajax({async:!1,dataType:"json",data:"GET",url:t,contentType:"application/json",success:function(t){t!=null&&t.objects.length>0&&(i={rs:t.objects});c(n,i);$("table.footable").trigger("footable_initialized");window.setTimeout(function(){$("#StatusAlert").removeClass("loading")},300)},error:function(n){NPVNexus.Status.error();console.log(n)}})},f=function(n){var t=n.split("/"),i=t[0],r=t[1],u=t[2];return u+"-"+i+"-"+r},c=function(n,t){var r=_.template($(".tableRow").html());n.html(r(t));i.trigger("footable_redraw");$(".tooltipicon").tooltip({});$("#TotalFee").html(NPVNexus.Formatters.currency(NPVNexus.View_Appraiser_Home.fee.toFixed(2)))},l=function(n,i){var r="",u="",f="",e=t;return n==1?(r=i+"-01-01",u=i+"-03-31"):n==2?(r=i+"-04-01",u=i+"-06-30"):n==3?(r=i+"-07-01",u=i+"-09-30"):n==4&&(r=i+"-10-01",u=i+"-12-31"),f="/api/v1/assignment/?employee="+e+"&role__in=APPRAISER,ASSOCIATE,RESEARCHER&appraisal__due_date__gte="+r+"&appraisal__due_date__lte="+u,f+="&fields=appraisal__job_number,appraisal__due_date,appraisal__engagement_property__property__name,appraisal__engagement_property__property__id,appraisal__id",f+",appraisal__engagement_property__engagement__client__name,appraisal__engagement_property__engagement__client__id,appraisal__engagement_property__property__property_subtype,appraisal__engagement_property__property__property_type,fee,role,appraisal__status,appraisal__hours_spent"};return{init:e,fee:0}}();NPVNexus.View_Appraisals=function(){var h,c,l,e=new Date,a=e.getFullYear(),g=e.getMonth()+1,n=[!1,!1],i=[null,null],r=null,o=[],t=null,u=null,f=!1,v=function(n,t,i){h=n;c=t;f=i;$(document).ready(function(){l=$("table.footable").footable({});p();y()})},y=function(){$(".dates,.range-div").hide();var n=new Date;NPVNexus.GetYearRange(2010,$("#QuartersYrs"));$("#Filter option:first-child").attr("selected","selected");$("#QuarterBtn").trigger("click")},p=function(){$(window).resize(function(){t.fnDraw(!1);$("table.footable").trigger("footable_initialized")});$("#TimeFilter").change(function(){$(this).val()=="Date Range"?($(".quarters-div").toggle(),$(".range-div").toggle()):$(this).val()=="Quarters"&&($(".quarters-div").toggle(),$(".range-div").toggle())});$("#QuarterBtn, #DateBtn").click(function(){k($("#Appraisals"),b())});$("#QuartersYrs > option").each(function(){$(this).val()==a&&$(this).prop("selected","true")});$("#QuartersQt > option").each(function(){$(this).val()==w()&&$(this).prop("selected","true")});$("#Filter").change(function(){$(this).val()=="Date Range"?($(".quarters").toggle(),$(".dates").toggle()):$(this).val()=="Quarters"&&($(".quarters").toggle(),$(".dates").toggle())})},w=function(){var i=new Date,n=i.getMonth()+1,t=0;return n>0&&n<4?t=1:n>3&&n<7?t=2:n>6&&n<10?t=3:n>9&&n<13&&(t=4),t},b=function(){var i,n="/api/v1/appraisal/?fields=engagement_property__property__id,engagement_property__property__name,due_date,invoice_sent,engagement_property__engagement__client__name,engagement_property__engagement__client__id,status,id,job_number,engagement_property__property__property_type,engagement_property__property__property_subtype",r="/api/v1/scheduled-appraisal/?fields=engagement_property__property__id,engagement_property__property__name,due_date,engagement_property__engagement__client__name,engagement_property__engagement__client__id,id,job_number,engagement_property__property__property_type,engagement_property__property__property_subtype",e,u,t;return f&&(n+=",fee",r+=",fee"),e=$("#Filter").val(),u=$("#OfficeList").val(),u!=""&&(n+="&office="+u,r+="&office="+u),t=$("#StatusFilter option:selected"),e=="Date Range"?(n+="&due_date__gte="+$("#StDate").val()+"&due_date__lte="+$("#EndDate").val(),i=r+"&due_date__gte="+$("#StDate").val()+"&due_date__lte="+$("#EndDate").val()):e=="Quarters"&&(n+="&"+s($("#QuartersQt").val(),$("#QuartersYrs").val()),i=r+"&"+s($("#QuartersQt").val(),$("#QuartersYrs").val())),$("#StatusFilter option:selected").attr("data-statuses")!="ALL"&&(n+="&status__in="+t.data("statuses"),i+="&status__in="+t.data("statuses")),t.attr("data-statuses")!="ALL"&&t.attr("data-statuses")!="IN_PROGRESS,INFO_NEEDED,DRAFT_SENT,COMPLETED,SCHEDULED,"&&t.attr("data-statuses")!="SCHEDULED"&&(i=r+"&due_date__lte=2000-01-01"),[n,i]},k=function(t,r){_.each(r,function(r,u){n[u]=!1;NPVNexus.Status.loading();$.ajax({async:!0,dataType:"json",data:"GET",url:r,contentType:"application/json",success:function(r){n[u]=!0;i[u]=r.objects;n[0]&&n[1]&&(NPVNexus.Status.loading("* Rendering..."),o=i[0].concat(i[1]),d(t,{rs:o}),$("table.footable").trigger("footable_redraw"),NPVNexus.Status.removeLoading())},error:function(n,t){n.status==500&&(NPVNexus.Status.error(),console.log(t))}})})},nt=function(n){var t=n.split("/"),i=t[0],r=t[1],u=t[2];return u+"-"+i+"-"+r},d=function(n,i){var s=NPVNexus.Formatters.friendlyName(!1),e=[{sTitle:"Due Date",mData:"due_date"},{sTitle:"Job #",mData:"job_number"},{sTitle:"Appraiser",mData:"lead_appraiser"},{sTitle:"Client",mData:"engagement_property__engagement__client__name"},{sTitle:"Type",mData:"engagement_property__property__property_type"},{sTitle:"Property",mData:"engagement_property__property__name"},{sTitle:"Address",mData:"base_address"},{sTitle:"City",mData:"base_address"},{sTitle:"State",mData:"base_address"},{sTitle:"Status",mData:"status"},{sTitle:"Invoiced",mData:"invoice_sent"}],o;f&&e.push({sTitle:"Fee",mData:"fee"});t!=null&&t.fnDestroy();t=$("#Appraisals").dataTable({aaData:i.rs,sDom:"frtpiS",iDisplayLength:20,bAutoWidth:!1,bDeferRender:!0,aaSorting:[[0,"desc"]],aoColumns:e,aoColumnDefs:[{aTargets:[0],mData:"due_date",mRender:function(n){var t="";return n!=null&&(t=n),t}},{aTargets:[1],mData:"job_number",mRender:function(n,t,i){var r="";return n!=null&&(r=i.status=="SCHEDULED"?"<a href='"+i.absolute_url+"/'>"+n+"<\/a>":"<a href='/appraisal/"+i.id+"'>"+n+"<\/a>"),r}},{aTargets:[2],mData:"lead_appraiser",mRender:function(n){var t="";return n!=null&&(t='<a href="#">'+n+"<\/a>"),t}},{aTargets:[3],mData:"engagement_property__engagement__client__name",mRender:function(n,t,i){var r="";return n!=null&&(r="<a href='/client/"+i.engagement_property__engagement__client__id+"'>"+n+"<\/a>"),r}},{aTargets:[4],mData:"engagement_property__property__property_type",mRender:function(n,t,i){var r="";return n!=null&&(r=n+(i.engagement_property__property__property_subtype?'<i class="expand glyphicon glyphicon-question-sign tooltipicon" data-toggle="tooltip" data-placement="top" title="'+i.engagement_property__property__property_subtype+'"> <\/i>':"")),r}},{aTargets:[5],mData:"engagement_property__property__name",mRender:function(n,t,i){var r="";return n!=null&&(i.portfolio&&(r="<a href='"+i.portfolio+"'><strong>Portfolio<\/strong><\/a>: "),r+="<a href='/property/"+i.engagement_property__property__id+"'>"+n+"<\/a>"),r}},{aTargets:[6],mRender:function(n){var t="",i;return n!=null&&n!="None"&&(i=JSON.parse(n).address1,t=i),t}},{aTargets:[7],mRender:function(n){var t="",i;return n!=null&&n!="None"&&(i=JSON.parse(n).city,t=i),t}},{aTargets:[8],mRender:function(n){var t="",i;return n!=null&&n!="None"&&(i=JSON.parse(n).state,t=i),t}},{aTargets:[9],mRender:function(n,t,i){var r="";return n!=null&&n!="None"&&(r=i.status_display?i.status_display:NPVNexus.Formatters.friendlyName(n)),r}},{aTargets:[10],mData:"invoice_sent",mRender:function(n){var t="<span class='"+s+"'><\/span>",i;return n!=null&&(i=NPVNexus.Formatters.friendlyName(n),t=i),t}}],fnDrawCallback:function(){u||(u=n.footable({}));$(".tooltipicon").tooltip({});u.trigger("footable_redraw")},fnInitComplete:function(){$("#TableHead #Appraisals_filter").remove();$("#TableHead").prepend($("#Appraisals_filter"));$("#Appraisals_filter input").before(' <i class="glyphicon glyphicon-info-sign tooltipicon" data-toggle="tooltip" data-placement="top" title="Filter result set with search terms"><\/i> ');$(".tooltipicon").tooltip({})},fnHeaderCallback:function(n){r&&window.clearTimeout(r);r=window.setTimeout(function(){$("#Appraisals thead th").each(function(t,i){var r="none";$(i).is(":visible")&&(r="table-cell");$(n).find("th:eq("+t+")").css("display",r);$(i).html()=="City"&&$(i).addClass("city");$(i).html()=="State"&&$(i).addClass("state");$(i).html()=="Status"&&$(i).addClass("status");$(i).html()=="Type"&&$(i).addClass("type");$(i).html()=="Address"&&$(i).addClass("address");$(i).html()=="Appraiser"&&$(i).addClass("appraiser");$(i).html()=="Invoiced"&&$(i).addClass("invoiced");$(i).hasClass("sorting")&&$(i).find(".footable-sort-indicator").length<=0&&$(i).append("<span class='footable-sort-indicator'><\/span>")})},300)}});o=i.rs.length;$(".totals b").html(o)},s=function(n,t){var i="",r="";return n==1?(i=t+"-01-01",r=t+"-03-31"):n==2?(i=t+"-04-01",r=t+"-06-30"):n==3?(i=t+"-07-01",r=t+"-09-30"):n==4&&(i=t+"-10-01",r=t+"-12-31"),"due_date__gte="+i+"&due_date__lte="+r};return{init:v,fee:0}}();NPVNexus.View_Property=function(){var n=function(){$(document).ready(function(){footable=$("table.footable").footable({})})};return{init:n,fee:0}}();NPVNexus.View_Portfolio=function(){var n,t=function(){$(document).ready(function(){r();n=$("table").footable({})})},i=function(n,t){if(t.length>0){var i=new google.maps.LatLng(t[0][0],t[0][1]),r={center:i,zoom:13},u=new google.maps.Map(n,r);_.each(t,function(n,i){var r=new google.maps.Marker({position:new google.maps.LatLng(t[i][0],t[i][1]),map:u})})}},r=function(){$("#BtnActive,#BtnHistorical").click(function(){u($(this).attr("id"))})},u=function(n){$(".tablebtn.active").removeClass("active");$("#"+n).addClass("active");switch(n){case"BtnActive":$("#Active").show().trigger("footable_resize");$("#Historical,#Similar").hide();break;case"BtnHistorical":$("#Historical").show().trigger("footable_resize");$("#Active,#Similar").hide()}$("table.footable").trigger("footable_redraw")};return{init:t,setUpMap:i}}();NPVNexus.View_Client=function(){var n=function(){$(document).ready(function(){footable=$("table.footable").footable({});t()})},t=function(){$("#BtnActive").click(function(){$("#Active").show();$("#Historical").hide();$("#BtnActive").addClass("active");$("#BtnHistorical").removeClass("active")});$("#BtnHistorical").click(function(){$("#Active").hide();$("#Historical").show();$(".btn-default.active").removeClass("active");$("#BtnHistorical").addClass("active")});$("#Update").on("click",function(){NPVNexus.Status.loading();$.ajax({type:"PATCH",dataType:"JSON",url:$("#Update").attr("action"),data:JSON.stringify({appraiser_must_sign:$("#AppraiserSign").prop("checked"),appraiser_must_inspect:$("#AppraiserInspect").prop("checked"),invoice_delivery:$("#InvoiceDelivery").html(),report_delivery:$("#ReportDelivery").val(),invoice_timing:$("#InvoiceTiming").val(),requirements_url:$("#ClientRequirements").val(),notes:$("#ClientNotes").html()}),contentType:"application/json",success:function(){var n=$("#ClientRequirements").val();NPVNexus.Status.success();n!=""?$("#ViewReq").attr("href",n).show():$("#ViewReq").attr("href",n).hide()},error:function(){NPVNexus.Status.error();$("#ClientRequirements").val()!="None"&&($("#ClientRequirements").val("None"),alert("Please enter a valid URL for Client Requirements."),$("#ViewReq").hide())}})})};return{init:n}}();NPVNexus.View_Employee_Appraisals=function(){function o(n,t){var i="",r="";return n==1?(i=t+"-01-01",r=t+"-03-31"):n==2?(i=t+"-04-01",r=t+"-06-30"):n==3?(i=t+"-07-01",r=t+"-09-30"):n==4&&(i=t+"-10-01",r=t+"-12-31"),"&appraisal__due_date__gte="+i+"&appraisal__due_date__lte="+r}var h,r,i,u,n,c=function(t,f){h=t;r=f;i=new Date;cMonth=i.getMonth()+1;n="ALL";u=i.getFullYear();$(document).ready(function(){a();l()})},l=function(){$("#Filter option:eq(0)").attr("selected","selected");NPVNexus.GetYearRange(2010,$("#QuarterYrs"));f($("#EmployeesDiv"),r,null)},a=function(){$("#QuarterBtn,#DateBtn").click(function(){var t=$("#OfficeList").val();url="/api/v1/employee/?split__gt=0";t!=n?(n=$("#OfficeList").val(),url="/api/v1/employee/?office__name="+n+"&split__gt=0",n=="ALL"&&(url="/api/v1/employee/?split__gt=0.0"),f($("#EmployeesDiv"),null,url)):$(".emp-link.opened").each(function(){var n=$(this),t=n.parents(".panel-heading").siblings(".panel-collapse").find("tbody"),i=n.parents(".panel-heading").siblings(".panel-collapse").attr("id"),r=s(i,!1);e(t,null,r)})});$("#Filter").change(function(){var n=$("#Filter").val();n=="Date Range"?($(".quarters").toggle(),$(".dates").show()):($(".quarters").toggle(),$(".dates").toggle())});$("#QuarterYrs > option").each(function(){$(this).val()==u&&$(this).prop("selected","true")});$("#QuartersQt > option").each(function(){$(this).val()==v()&&$(this).prop("selected","true")});$("#EmployeesDiv").delegate(".emp-link","click",function(n){if(n.preventDefault(),$(this).hasClass("opened"))$(this).removeClass("opened"),$(this).closest(".panel-heading").siblings(".panel-collapse").slideUp();else{$(this).closest(".panel-heading").siblings(".panel-collapse").slideDown();$(this).addClass("opened");$(window).scrollTop($(this).closest(".panel-heading").offset().top);var t=$(this).closest(".panel-heading").siblings(".panel-collapse").find("tbody"),i=$(this).closest(".panel-heading").siblings(".panel-collapse").attr("id");url=s(i,!1);e(t,null,url)}})},v=function(){var i=new Date,n=i.getMonth()+1,t=0;return n>0&&n<4?t=1:n>3&&n<7?t=2:n>6&&n<10?t=3:n>9&&n<13&&(t=4),t},f=function(n,i,r){var u={},f=$("#AppraiserTemplate").html();!i&&r?(NPVNexus.Status.loading(),$.ajax({url:r,type:"GET",dataType:"json",contentType:"application/json",success:function(i){NPVNexus.Status.success("Updated");i.objects&&(u={rs:i.objects},t(n,f,u))},error:function(n){console.log(n.responseText);App.status.error()}})):(u={rs:i},t(n,f,u))},e=function(n,i,r){var u={rs:null},f;n.html('<h3 class="loading">Loading...<\/h3>');f=$("#AppraisalTemplate").html();!i&&r?(NPVNexus.Status.loading(),$.ajax({type:"GET",async:!1,dataType:"json",contentType:"application/json",url:r,success:function(i){NPVNexus.Status.removeLoading();i.meta.total_count!=0&&(u={rs:i.objects,ttl:i.meta.total_count},passTest=[],_.each(u.rs,function(n){var t=n.appraisal+"?fields=engagement_property__property__id,engagement_property__property__name,due_date,invoice_sent,hours_spent,engagement_property__property__client__name,engagement_property__property__client__id,fee,status,id,job_number";$.ajax({url:t,type:"GET",dataType:"json",contentType:"application/json",async:!1,success:function(t){n.extra=t},error:function(n){console.log(n.responseText)}})}));n.closest("table").siblings(".total-records").find("span").html(i.meta.total_count);t(n,f,u)},error:function(n){console.log(n)}})):(u.rs=i,t(n,f,u))},t=function(n,t,i){n.html(_.template(t,i));n.closest(".footable").footable();n.closest(".footable").trigger("footable_redraw");var r=NPVNexus.View_Employee_Appraisals.fee;n.closest("table").siblings(".totals").find("span").html(r)},s=function(n,t){var r="/api/v1/assignment/?employee="+n+"&role__in=APPRAISER,INSPECTOR,PROCURER,REVIEWER",f;if(t){var e=new Date,s=e.getFullYear(),i=e.getMonth()+1,u=0;i>1&&i<4?u=1:i>3&&i<7?u=2:i>6&&i<10?u=3:i>9&&i<13&&(u=4);r+=o(u,s)}else r+=$("#Filter").val()=="Date Range"?"&appraisal__due_date__gte="+$("#StDate").val()+"&appraisal__due_date__lte="+$("#EndDate").val():o($("#QuartersQt").val(),$("#QuarterYrs").val());return f=$("#StatusFilter").val(),f!="ALL"&&f!="ALL w/o Cancelled"?r+="&appraisal__status="+f:f=="ALL w/o Cancelled"&&(r+="&appraisal__status__in=COMPLETED&appraisal__status__in=IN_PROGRESS&appraisal__status__in=INFO_NEEDED&appraisal__status__in=DRAFT_SENT"),r};return{init:c,fee:0}}();NPVNexus.View_Work_In_Progress=function(){var n=function(){$(document).ready(function(){t()})},t=function(){var n="",f=0,t,i,r,u;$(".chicago .line-item").each(function(){$this=$(this);n==$this.find(".name").html()||n==""?(n=$this.find(".name").html(),f+=parseFloat($this.find(".fee").attr("data-val"))):(n=$this.find(".name").html(),$this.before('<tr class="summary"><td colspan="11"><div class="totals"><b>Total:'+NPVNexus.Formatters.currency(f)+"<\/b><\/div><\/td><\/tr>"),f=parseFloat($this.find(".fee").attr("data-val")));$this.is(":last-child")&&$this.after('<tr class="summary"><td colspan="11"><div class="totals"><b>Total:'+NPVNexus.Formatters.currency(f)+"<\/b><\/div><\/td><\/tr>");n=$this.find(".name").html()});t="";i=0;$(".atlanta .line-item").each(function(){$this=$(this);t==$this.find(".name").html()||t==""?i+=parseFloat($this.find(".fee").attr("data-val")):(t=$this.find(".name").html(),$this.before('<tr class="summary"><td colspan="11"><div class="totals"><b>Total:'+NPVNexus.Formatters.currency(i)+"<\/b><\/div><\/td><\/tr>"),i=parseFloat($this.find(".fee").attr("data-val")));$this.is(":last-child")&&$this.after('<tr class="summary"><td colspan="11"><div class="totals"><b>Total:'+NPVNexus.Formatters.currency(i)+"<\/b><\/div><\/td><\/tr>");t=$this.find(".name").html()});r="";u=0;$(".newport .line-item").each(function(){$this=$(this);r==$this.find(".name").html()||r==""?u+=parseFloat($this.find(".fee").attr("data-val")):(r=$this.find(".name").html(),$this.before('<tr class="summary"><td colspan="11"><div class="totals"><b>Total:'+NPVNexus.Formatters.currency(u)+"<\/b><\/div><\/td><\/tr>"),u=parseFloat($this.find(".fee").attr("data-val")));$this.is(":last-child")&&$this.after('<tr class="summary"><td colspan="11"><div class="totals"><b>Total:'+NPVNexus.Formatters.currency(u)+"<\/b><\/div><\/td><\/tr>");r=$this.find(".name").html()})};return{init:n}}();NPVNexus.GetYearRange=function(n,t){for(var i=[],r=(new Date).getFullYear(),u=n||2010;u<=r+5;)i.push(u++);_.each(i,function(n){var i=n==r?"selected='selected'":"";t.append("<option value='"+n+"' "+i+">"+n+"<\/option>")})};
/*
//# sourceMappingURL=Nexusv1.min.js.map
*/